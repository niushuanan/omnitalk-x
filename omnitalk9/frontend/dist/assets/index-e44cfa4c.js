import{c as le,p as ce,S as g,a as Be,b as De,d as qe,e as ue,f as ge,j as Ke,g as he,v as fe,h as ve,t as Ue,i as We,l as Fe,s as Ge,k as He,m as ze,r as Ve,o as xe,n as Je,q as Xe,u as Qe,w as Ye,x as Ze,y as et,z as tt,A as st,B as ye,C as ot,D as at,E as nt,F as be,G as rt,H as n,I as it,J as lt,K as ne,L as b,M as ct,N as mt,O as dt,P as re,R as pt,Q as _t,T as ut,U as gt,V as ht,W as ft,X as vt,Y as xt,Z as yt}from"./vendor-be714d3f.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}})();const bt="clear_context",jt="serial",wt="serial_session",V="chatgpt",Me="openai",It=["openai","minimax","claude","gpt-4"],je=["chatgpt","claude","grok","gemini","glm","kimi","minimax","qwen","deepseek","seed"],me=le()(ce((e,t)=>({token:"",username:"user",mode:jt,updateMode:s=>{e({mode:s})}}),{name:"config"})),Ct=({children:e,inline:t,className:s,...a})=>{const o=/language-(\w+)/.exec(s||"")||[];return me(),g.registerLanguage("assembly",Be),g.registerLanguage("python",De),g.registerLanguage("c",qe),g.registerLanguage("c/c++",ue),g.registerLanguage("clike",ue),g.registerLanguage("c++",ge),g.registerLanguage("cpp",ge),g.registerLanguage("java",Ke),g.registerLanguage("csharp",he),g.registerLanguage("c#",he),g.registerLanguage("vb",fe),g.registerLanguage("visual basic",fe),g.registerLanguage("javascript",ve),g.registerLanguage("typescript",Ue),g.registerLanguage("css",We),g.registerLanguage("less",Fe),g.registerLanguage("js",ve),g.registerLanguage("sql",Ge),g.registerLanguage("php",He),g.registerLanguage("go",ze),g.registerLanguage("r",Ve),g.registerLanguage("objective-c",xe),g.registerLanguage("objc",xe),g.registerLanguage("matlab",Je),g.registerLanguage("swift",Xe),g.registerLanguage("ruby",Qe),g.registerLanguage("lua",Ye),g.registerLanguage("json",Ze),g.registerLanguage("yaml",et),g.registerLanguage("xml",tt),g.registerLanguage("dDockerfile",st),g.registerLanguage("markdown",ye),g.registerLanguage("md",ye),g.registerLanguage("makefile",ot),g.registerLanguage("latex",at),g.registerLanguage("llvm",nt),g.registerLanguage("shell",be),g.registerLanguage("sh",be),g.registerLanguage("bash",rt),!t&&o?n.jsx(g,{language:(o[1]||"Python").toLowerCase(),style:it,customStyle:{borderRadius:"10px"},PreTag:"div",...a,children:e}):n.jsx("code",{className:s,...a,children:e})},St=React.memo(Ct),de=(...e)=>{const t=e.map(s=>typeof s=="function"?s:()=>s);return(...s)=>{let a=0,o;for(o=t.length===0?s:t[a++](...s);a<t.length;)o=t[a++](o);return o}},we="locale",kt=()=>{const e=window.localStorage.getItem(we);return e?e==="en-US"?"en-US":"zh-CN":(localStorage.setItem(we,"en-US"),"en-US")};let At=kt();const ie=()=>At,Ie=e=>{const t=document.cookie.split(";");for(let s=0;s<t.length;s++)if(t[s].split("=")[0].trim()===e){const o=new Date;o.setTime(o.getTime()-60),document.cookie=`${t[s]};expires=${o.toUTCString()};path=/;domain=${{}.VITE_COOKIE_DOMAIN}`;break}},Re={tokenKey:"x_token",cookieTokenKey:"uaa-token",getFromCookie(){return lt.get(this.cookieTokenKey)},storage(e){return e==null?(localStorage.removeItem(this.tokenKey),!1):(localStorage.setItem(this.tokenKey,e),!0)},update(e){localStorage.getItem(this.tokenKey)!==e&&this.storage(e)},get(){const e=this.getFromCookie();return this.update(e),e||localStorage.getItem(this.tokenKey)},has(){return!!this.get()},removeAll(){Ie(this.cookieTokenKey),Ie("ssouid"),localStorage.removeItem(this.tokenKey)}},Lt=()=>"/login";function Mt(e,t=50){let s=null;return(...a)=>{s?clearTimeout(s):e.apply(this,a),s=setTimeout(()=>{e.apply(this,a)},t)}}const Pe=e=>{const t=document.getElementById(e);t&&t.scrollTo({top:999999,behavior:"smooth"})},X=Mt(e=>Pe(e),50),Rt=(e,t=null)=>ne?{onTouchEnd:t||e}:{onClick:e||t},Pt={provider:"user",model:"user",webui:{avatar:"/avatars/用户.jpg",background:"#71e875"}},Tt={provider:"admin",model:"admin",webui:{avatar:"https://oss.openmmlab.com/frontend/OpenAOE/A.svg",background:"linear-gradient(rgb(255 255 255 / 80%) 0%, rgb(168 245 179) 100%)"}},Nt={chatgpt:{provider:"openai",webui:{avatar:"/avatars/ChatGPT-Logo.png",background:"linear-gradient(180deg, rgba(156, 206, 116, 0.15) 0%, #1a8d15 100%)"}},claude:{provider:"anthropic",webui:{avatar:"/avatars/claude_logo.jpeg",background:"linear-gradient(180deg, rgba(141, 90, 181, 0.15) 0%, rgba(106, 39, 123, 0.7) 53.12%, #663E9A 100%)"}},grok:{provider:"xai",webui:{avatar:"/avatars/grok-icon.webp",background:"linear-gradient(180deg, rgba(0, 0, 0, 0.15) 0%, rgba(0, 0, 0, 0.8) 100%)"}},gemini:{provider:"google",webui:{avatar:"/avatars/gemini_icon-logo_brandlogos.net_aacx5.png",background:"linear-gradient(180deg, rgba(181, 90, 90, 0.15) 0%, #fa5ab1 100%)"}},glm:{provider:"zhipu",webui:{avatar:"/avatars/z.webp",background:"linear-gradient(180deg, rgba(70, 130, 255, 0.15) 0%, rgba(70, 130, 255, 0.8) 100%)"}},kimi:{provider:"moonshot",webui:{avatar:"/avatars/kimi.jpeg",background:"linear-gradient(180deg, rgba(66, 133, 244, 0.15) 0%, rgba(66, 133, 244, 0.8) 100%)"}},minimax:{provider:"minimax",webui:{avatar:"/avatars/MiniMax.png",background:"linear-gradient(180deg, rgba(207, 72, 72, 0.15) 0%, rgba(151, 43, 43, 0.7) 53.12%, #742828 100%)"}},qwen:{provider:"qwen",webui:{avatar:"/avatars/Qwen_logo.svg.png",background:"linear-gradient(180deg, rgba(255, 102, 0, 0.15) 0%, rgba(255, 102, 0, 0.8) 100%)"}},deepseek:{provider:"deepseek",webui:{avatar:"/avatars/DeepSeek.png",background:"linear-gradient(180deg, rgba(65, 105, 225, 0.15) 0%, rgba(65, 105, 225, 0.8) 100%)"}},seed:{provider:"bytedance",webui:{avatar:"/avatars/seed.png",background:"linear-gradient(180deg, rgba(255, 0, 100, 0.15) 0%, rgba(255, 0, 100, 0.8) 100%)"}}},Et=["chatgpt","claude","grok","gemini","glm","kimi","minimax","qwen","deepseek","seed"],Ot={models:null,streamModels:[]},pe=React.createContext(Ot),q="",K={prompt:"",messages:[],role_meta:{user_name:"user",bot_name:"assistant"},stream:!0,type:"json",temperature:.7,max_tokens:4096},D=new Map;D.set("openai",{url:`${q}/v1/openai/chat/completions`,model:"openai/gpt-5.2",...K});D.set("anthropic",{url:`${q}/v1/anthropic/chat/completions`,model:"anthropic/claude-opus-4.5",...K});D.set("xai",{url:`${q}/v1/xai/chat/completions`,model:"x-ai/grok-4",...K});D.set("google",{url:`${q}/v1/google/chat/completions`,model:"google/gemini-3-pro-preview",...K});D.set("zhipu",{url:`${q}/v1/zhipu/chat/completions`,model:"z-ai/glm-5",...K});D.set("moonshot",{url:`${q}/v1/moonshot/chat/completions`,model:"moonshotai/kimi-k2.5",...K});D.set("minimax",{url:`${q}/v1/minimax/chat/completions`,model:"minimax/minimax-m2.5",...K});D.set("qwen",{url:`${q}/v1/qwen/chat/completions`,model:"qwen/qwen3-max-thinking",...K});D.set("deepseek",{url:`${q}/v1/deepseek/chat/completions`,model:"deepseek/deepseek-v3.2",...K});const Te=e=>{const t={"Content-Type":"application/json"};return e&&(t["X-Api-Key"]=e),t},$t=e=>{var t;return((t=D.get(e))==null?void 0:t.url)||D.get(Me).url},Bt=e=>{const t=localStorage.getItem("system_prompt_"+e);return t&&t.trim()?t:{chatgpt:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=ChatGPT，小庄微信群里的朋友。简洁回复，像微信聊天。",claude:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Claude，小庄微信群里的朋友。简洁回复，像微信聊天。",grok:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Grok，小庄微信群里的朋友。简洁回复，像微信聊天。",gemini:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Gemini，小庄微信群里的朋友。简洁回复，像微信聊天。",glm:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=GLM，小庄微信群里的朋友。简洁回复，像微信聊天。",kimi:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Kimi，小庄微信群里的朋友。简洁回复，像微信聊天。",minimax:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=MiniMax，小庄微信群里的朋友。简洁回复，像微信聊天。",qwen:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Qwen，小庄微信群里的朋友。简洁回复，像微信聊天。",deepseek:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=DeepSeek，小庄微信群里的朋友。简洁回复，像微信聊天。",seed:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Seed，小庄微信群里的朋友。简洁回复，像微信聊天。"}[e]||""},Ce=(e,t,s,a)=>{const o=D.get(e)||D.get(Me),r=Bt(t),m=r?[{role:"system",content:r}]:[];return{model:t||o.model,messages:[...m,...a.map(x=>({role:x.sender_type==="user"?"user":"assistant",content:x.text})),{role:"user",content:s}],temperature:o.temperature||.7,max_tokens:o.max_tokens||4096,stream:!0}},Dt={development:"",staging:"",production:""},qt={mock:"",development:"",staging:"",production:""},Ne="production",Kt=Dt[Ne],Ut=qt[Ne],Wt=[],Ft=e=>{const t={};return Wt.find(a=>e.url.endsWith(a))||Re.get(),{...e,headers:{lang:ie(),...e.headers,...t}}},Gt=e=>({...e,headers:{...e.headers,"Client-Type":"app",type:0}}),Ht=[Ft,Gt],Ee=()=>{Re.removeAll()},zt=e=>{const t=e.data;return e.__meta.isAllResponseBody?t:t.data},Vt=e=>{const t=e.data,a=!e.__meta.isIgnoreError;return t.success===!1&&a&&b.error(t.msg),e},Jt=e=>{const t=e.data;return t&&t.msgCode==="A0202"&&Ee(),e},Xt=e=>{const t=e.data;return t&&t.msgCode==="C1600"&&(window.location.href=Lt()),e},te=(e,t=!1)=>{t||b.error(e)},Qt=e=>{if(e.response){const s=e.__meta.isIgnoreGatewayError,a=e.response.status;switch(console.log(e.code,"error....."),a){case 401:case 403:Ee();break;case 500:te(ie()==="zh-CN"?"服务器没有响应，请稍后再试":"Sever error, please try again later.",s);break;default:e.code==="ERR_NETWORK"?te(ie()==="zh-CN"?"网络出错了，请稍后再试":"Network error, please try again later.",s):te(`${a}: ${e.message||"unknown error"}`,s)}}return Promise.reject(e)},Oe=[Jt,Xt,Vt,zt],$e=[Qt],z=ct.create({method:"get",timeout:6e4,responseType:"json",paramsSerializer:e=>mt.stringify(e,{indices:!1})}),G=new Map,Yt=e=>{let t={};return G.has(e.config.url)&&(t=G.get(e.config.url),G.delete(e.config.url)),{...e,__meta:t}},Zt=e=>{let t={};return G.has(e.config.url)&&(t=G.get(e.config.url),G.delete(e.config.url)),{...e,__meta:t}};Oe.unshift(Yt);$e.unshift(Zt);const es=de(...Ht),ts=de(...Oe),ss=de(...$e);z.interceptors.request.use(es,e=>Promise.reject(e));z.interceptors.response.use(ts,ss);const os=(e,{method:t="GET",params:s={},data:a={},...o})=>{const r=`${Kt}${e}`;switch(t.toLowerCase()){case"get":return z.get(r,{params:s,...o});case"delete":return z.delete(r,{params:s,data:a,...o});case"post":return z.post(r,a,{params:s,...o});case"put":return z.put(r,a,{params:s,...o});default:return Promise.resolve({then:m=>m({msgCode:"300",msg:"Method Not Allowed",traceId:"-1",total:0,status:405,data:{}})})}},as=(e,t={},s=Ut)=>{const o=`${s}/${e}`.replace(/\/\//g,"/");return t.meta&&(G.set(o,t.meta),delete t.meta),os(o,t)};async function ns(e,t,s){const a=Te();return as(e,{method:"POST",headers:{...a},data:t,signal:s,meta:{isAllResponseBody:!0}})}function U(e){return{id:Date.now(),provider:"openai",date:new Date().toLocaleString(),sender_type:"user",text:"",...e}}function F(e){return{id:Date.now()+Math.random(),name:V,bot:"",messages:[],isShow:!0,clearContextIndex:0,...e}}const Q=le()(ce((e,t)=>({hasStreaming:!1,sessions:[F({name:wt}),F({name:V})],currentSessionIndex:0,globalId:0,controller:{},newSession(s){const a=t().sessions,o=a.findIndex(m=>m.name===s);if(o>0){t().updateSession(o,{isShow:!0});return}const r=F({name:s,isShow:!0});e(()=>({globalId:t().globalId+1})),r.id=t().globalId,a.push(r),e(()=>({sessions:a}))},removeSession(s){const o=t().sessions.findIndex(r=>r.name===s);o&&t().updateSession(o,{isShow:!1})},getSession(s){const a=t().sessions,o=a.findIndex(r=>r.name===s);return o<0?F({name:s}):a[o]},switchToSession(s){const a=t().sessions;let o=a.findIndex(r=>r.name===s);if(o<0){const r=F({name:s,bot:s,isShow:!0});a.push(r),o=a.length-1}e({currentSessionIndex:o,sessions:a.map((r,m)=>({...r,isShow:m===o}))})},onNewMessage(s,a=0){t().sessions[a].messages.push(s),e(()=>({sessions:t().sessions}))},addMessage(s,a){const o=t().sessions,r=o.findIndex(m=>m.name===s);if(r>=0)o[r].messages.push(a),e(()=>({sessions:[...o]}));else{const m=F({name:s,bot:s,isShow:!0,messages:[a]});o.push(m),e(()=>({sessions:[...o]}))}},deleteMessage(s,a){const o=t().sessions.find(r=>r.name===s);o&&(o.messages.splice(a,1),e(()=>({sessions:t().sessions})))},retry(s,a,o,r=!0){const m=t().lastUserMessage(s).text;t().lastMessage(s).id===t().lastBotMessage(s).id&&t().getSession(s).clearContextIndex!==t().getSession(s).messages.length&&(t().deleteMessage(s,t().getSession(s).messages.length-1),t().deleteMessage(s,t().getSession(s).messages.length-1)),t().onUserInput(m,a,o,s,r)},async onUserInput(s,a,o,r,m=!0){var B;const d=t().sessions.findIndex(p=>p.name===r),x=t().sessions[d];if(!x)return;const k=x.clearContextIndex||0,w=x.messages.slice(k).filter(p=>p.isError!==!0).map(p=>({text:p.text,sender_type:p.sender_type})),v=x.messages.length+1,S=U({text:s,provider:"user",sender_type:"user"}),l=U({provider:a,model:o,text:"...",sender_type:"bot",id:S.id+1,stream:!0});t().onNewMessage(S,d),t().onNewMessage(l,d),X(`chat-wrapper-${x.id}`);const M=new AbortController,O=t().controller;O[r]=M,e(()=>({controller:{...O}}));const R={method:"POST",headers:Te(),body:JSON.stringify({...Ce(a,o,s,w)})},I=$t(a);let P=!0;if(m)dt(I,{...R,signal:M.signal,async onopen(p){const h=p.headers.get("content-type");if(h!=null&&h.includes("text/event-stream")||(P=!1),!p.ok)throw new Error(p.status+p.statusText)},onmessage:p=>{if(P&&typeof p.data=="string"&&p.data.charAt(0)==="{"){const h=JSON.parse(p.data);if(h&&h.success.toString()==="true"){if(h.stop_reason==="max_token"){l.stream=!1,t().updateMessage(d,v,A=>{A.stream=!1,A.text=l.text.concat(`
 > ${h.stop_reason}`)});return}l.stream=!0,l.text=l.text.startsWith("...")?l.text.slice(3).concat(h.msg):l.text.concat(h.msg),X(`chat-wrapper-${x.id}`),t().updateMessage(d,v,A=>{A.text=l.text,A.stream=l.stream})}if(h&&h.success==="false")throw new Error(h.msg)}},onerror(p){console.log(`[BOT] request error from ${o}: 
`,p),l.stream=!1,t().updateMessage(d,v,A=>{A.stream=l.stream,A.text=p.message.includes("Please reduce the length of the messages.")?p.message:`${l.text}
 > Oops... Something went wrong (°⌓°)`,A.isError=!0});const h=t().controller;throw delete h[r],e(()=>({controller:{...h}})),p},onclose(){l.stream=!1,t().updateMessage(d,v,h=>{h.stream=l.stream});const p=t().controller;delete p[r],e(()=>({controller:{...p}})),console.log("[BOT] answering closed. ")}});else try{const p=await ns(I,Ce(a,o,s,w),M.signal);if(p.msgCode==="10000"&&p.data){if(a==="google"){if(!p.data.candidates&&p.data.filters){l.stream=!1,t().updateMessage(d,v,h=>{h.stream=l.stream,h.text=`${l.text}
 > Oops... Something went wrong (°⌓°)`,h.isError=!0});return}l.text=(B=p.data.candidates[0])==null?void 0:B.content}else a==="claude"?l.text=p.data.completion:l.text=p.data;l.stream=!1,t().updateMessage(d,v,h=>{h.text=l.text,h.stream=l.stream}),X(`chat-wrapper-${x.id}`)}else l.stream=!1,t().updateMessage(d,v,h=>{h.stream=l.stream,h.text=`${l.text}
 > Oops... Something went wrong (°⌓°)`,h.isError=!0})}catch{t().updateMessage(d,v,h=>{h.stream=!1,h.text=`${l.text}
 > Oops... Something went wrong (°⌓°)`,h.isError=!0})}finally{const p=t().controller;delete p[r],e(()=>({controller:{...p}}))}},updateMessage(s,a,o){const m=t().sessions[s].messages[a];m.date=new Date().toLocaleString(),o(m),e(()=>({sessions:t().sessions}))},updateMessageById(s,a,o){const r=t().sessions.find(d=>d.name===s);if(!r)return;const m=r.messages.find(d=>d.id===a);m&&(Object.assign(m,o),m.date=new Date().toLocaleString(),e(()=>({sessions:[...t().sessions]})))},lastMessage(s){const a=t().sessions.find(r=>r.name===s);if(!a)return U({text:""});const o=a==null?void 0:a.messages;return Array.isArray(o)&&o.length>0?o.slice(-1)[0]:U({text:""})},lastUserMessage(s){const a=t().sessions.find(r=>r.name===s);if(!a)return U({text:""});const o=[...a.messages];return Array.isArray(o)&&o.length>0?o.reverse().find(r=>r.sender_type==="user"):U({text:""})},lastBotMessage(s){const a=t().sessions.find(r=>r.name===s);if(!a)return U({text:""});const o=[...a.messages];return Array.isArray(o)&&o.length>0?o.reverse().find(r=>r.sender_type==="bot"&&r.model!=="admin"):U({text:""})},updateSession(s,a){const o=t().sessions;let r=o[s];r={...r,...a},o[s]=r,e(()=>({sessions:o}))},closeController(s){const a=t().controller,o=a==null?void 0:a[s];if(o){o.abort&&o.abort(),delete a[s],e(()=>({controller:{...a}}));const r=t().sessions.findIndex(d=>d.name===s),m=t().sessions[r];t().updateMessage(r,m.messages.length-1,d=>{d.stream=!1,d.text=d.text.concat(`
 > Request canceled。`)}),X(`chat-wrapper-${m.id}`)}},clearAllData(){localStorage.removeItem("chat"),localStorage.removeItem("ai_context_history"),e(()=>({sessions:[F({name:V})]})),window.location.reload()},clearCurrentSession(s){const a=t().sessions,o=a.findIndex(r=>r.name===s);if(o>=0&&(a[o].messages=[],a[o].clearContextIndex=0,e(()=>({sessions:[...a]}))),s==="group")localStorage.removeItem("ai_context_history");else{const r="ai_context_history",m=localStorage.getItem(r);if(m){const d=JSON.parse(m);delete d[s],localStorage.setItem(r,JSON.stringify(d))}}}}),{name:"chat"})),Y=le()(ce((e,t)=>({chosenBotNames:je,currentBot:V,privateChat:null,updateCurrentBot:s=>{e({currentBot:s})},setPrivateChat:s=>{e({privateChat:s})},addBot:s=>{const{chosenBotNames:a}=t();a.includes(s)||e({chosenBotNames:[...a,s]})},removeBot:s=>{const{chosenBotNames:a}=t();e({chosenBotNames:a.filter(o=>o!==s)})},getCurrentBot:()=>t().currentBot||V,clearBots:()=>{localStorage.removeItem("bot"),e({chosenBotNames:je})}}),{name:"bot"})),rs="_hidden-scrollbar_fbitr_1",is="_styled-scrollbar_fbitr_8",ls="_sessions_fbitr_27",cs="_preview-sessions_fbitr_39",ms="_session-wrapper_fbitr_51",ds="_chat_fbitr_56",ps="_empty-chat_fbitr_68",_s="_empty-chat-text_fbitr_75",us="_message_fbitr_90",gs="_message-wrapper_fbitr_98",hs="_chat-user-title_fbitr_159",fs="_chat-bot-title_fbitr_167",vs="_message-item_fbitr_175",xs="_stream-wrapper_fbitr_180",ys="_glow_fbitr_1",bs="_chat-user_fbitr_159",js="_chat-bot_fbitr_167",ws="_chat-operations_fbitr_199",Is="_chat-date_fbitr_210",Cs="_chat-checkbox_fbitr_217",Ss="_model-avatar_fbitr_256",ks="_model-avatar-img_fbitr_271",As="_model-name_fbitr_278",Ls="_copy-code-btn_fbitr_284",Ms="_clear-line_fbitr_297",Rs="_markdown-block_fbitr_319",Ps="_mario_fbitr_1",Ts="_running-mario_fbitr_1",E={"hidden-scrollbar":"_hidden-scrollbar_fbitr_1",hiddenScrollbar:rs,"styled-scrollbar":"_styled-scrollbar_fbitr_8",styledScrollbar:is,sessions:ls,"preview-sessions":"_preview-sessions_fbitr_39",previewSessions:cs,"session-wrapper":"_session-wrapper_fbitr_51",sessionWrapper:ms,chat:ds,"empty-chat":"_empty-chat_fbitr_68",emptyChat:ps,"empty-chat-text":"_empty-chat-text_fbitr_75",emptyChatText:_s,message:us,"message-wrapper":"_message-wrapper_fbitr_98",messageWrapper:gs,"chat-user-title":"_chat-user-title_fbitr_159",chatUserTitle:hs,"chat-bot-title":"_chat-bot-title_fbitr_167",chatBotTitle:fs,"message-item":"_message-item_fbitr_175",messageItem:vs,"stream-wrapper":"_stream-wrapper_fbitr_180",streamWrapper:xs,glow:ys,"chat-user":"_chat-user_fbitr_159",chatUser:bs,"chat-bot":"_chat-bot_fbitr_167",chatBot:js,"chat-operations":"_chat-operations_fbitr_199",chatOperations:ws,"chat-date":"_chat-date_fbitr_210",chatDate:Is,"chat-checkbox":"_chat-checkbox_fbitr_217",chatCheckbox:Cs,"model-avatar":"_model-avatar_fbitr_256",modelAvatar:Ss,"model-avatar-img":"_model-avatar-img_fbitr_271",modelAvatarImg:ks,"model-name":"_model-name_fbitr_278",modelName:As,"copy-code-btn":"_copy-code-btn_fbitr_284",copyCodeBtn:Ls,"clear-line":"_clear-line_fbitr_297",clearLine:Ms,"markdown-block":"_markdown-block_fbitr_319",markdownBlock:Rs,mario:Ps,"running-mario":"_running-mario_fbitr_1",runningMario:Ts};async function Ns(e){try{await navigator.clipboard.writeText(e),b.success("copied!")}catch{const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy"),b.success("copied!")}catch{b.error("copy failed")}document.body.removeChild(s)}}function Es(e){const t=React.useRef(null),[s,a]=React.useState(!1),o=()=>{if(t.current){const r=t.current.innerText;Ns(r)}};return n.jsx("pre",{ref:t,children:n.jsxs("div",{onMouseOver:()=>a(!0),onFocus:()=>a(!0),onMouseLeave:()=>a(!1),children:[s&&n.jsx("span",{className:E.copyCodeBtn,...Rt(o)}),e.children]})})}function Os(e){var R;const{models:t}=React.useContext(pe),[s,a]=React.useState(""),o=React.useRef(null),{message:r}=e,m=r.sender_type==="user"||r.provider==="user",d=r.sender_type==="admin"||r.provider==="admin",x=r.sender_type===bt,k=re(E.messageWrapper,m?E.chatUser:E.chatBot),w=me();React.useEffect(()=>{const I=localStorage.getItem("user_avatar");I&&a(I)},[]);const v=I=>{var p;const P=(p=I.target.files)==null?void 0:p[0];if(!P)return;if(!P.type.startsWith("image/")){b.warning("请选择图片文件");return}const B=new FileReader;B.onload=h=>{var H;const A=(H=h.target)==null?void 0:H.result;localStorage.setItem("user_avatar",A),a(A),b.success("头像已更新")},B.onerror=()=>{b.error("读取文件失败")},B.readAsDataURL(P)},l=(()=>m?Pt:d?Tt:t[r.model])();if(!m&&!x&&!l)return null;w.mode;const M=(R=l==null?void 0:l.webui)==null?void 0:R.avatar,O=s||"ME";return n.jsxs("div",{className:E.message,style:{justifyContent:m?"flex-end":"flex-start"},children:[n.jsx("input",{ref:o,type:"file",accept:"image/*",style:{display:"none"},onChange:v}),x?n.jsx("div",{className:E.clearLine,children:"Context cleared"}):n.jsxs(n.Fragment,{children:[!ne&&!m&&n.jsx("div",{className:E.modelAvatar,title:(l==null?void 0:l.provider)||r.provider,children:n.jsx("img",{src:M||"",className:E.modelAvatarImg,alt:(l==null?void 0:l.model)||r.provider})}),n.jsx("div",{className:k,style:{borderRadius:m?"10px 1px 10px 10px":"1px 10px 10px 10px"},children:n.jsx(pt,{className:E.markdownBlock,remarkPlugins:[_t,ut,gt],rehypePlugins:[ht],components:{code:St,pre:Es},children:r.text})}),!ne&&m&&n.jsx("div",{className:E.modelAvatar,onContextMenu:I=>{var P;I.preventDefault(),I.stopPropagation(),(P=o.current)==null||P.click()},title:"右键上传头像",children:O!=="ME"?n.jsx("img",{src:O,className:E.modelAvatarImg,alt:"user"}):"ME"})]})]})}function Se(e){const{session:t}=e;return React.useEffect(()=>{Pe(`chat-wrapper-${t.id}`)},[t.messages.length]),n.jsx("div",{className:E.sessionWrapper,children:n.jsx("div",{className:E.chat,id:`chat-wrapper-${t.id}`,children:Array.isArray(t.messages)&&t.messages.map((s,a)=>n.jsx("div",{className:E.messageItem,children:n.jsx(Os,{message:s,sessionInfo:{id:t.id,name:t.name,bot:t.bot}},s.id)},s.id))})})}const $s=()=>{const e=Q(),t=Y(),{sessions:s}=e,a=t.privateChat;return n.jsx("div",{className:E.sessions,children:Array.isArray(s)&&s.map(o=>a?o.name!==a?null:n.jsx(Se,{session:o},o.id):o.name==="group"?n.jsx(Se,{session:o},o.id):null)})},Bs="_model-list-container_mf0lv_1",Ds="_settings-icon_mf0lv_7",qs="_models-list_mf0lv_29",Ks="_home-models_mf0lv_38",Us="_model-avatar_mf0lv_45",Ws="_model-avatar-img_mf0lv_63",Fs="_model-name_mf0lv_70",Gs="_model-avatar-chosen_mf0lv_89",Hs="_modal-overlay_mf0lv_93",zs="_fadeIn_mf0lv_1",Vs="_settingsModal_mf0lv_115",Js="_slideUp_mf0lv_1",Xs="_modal-header_mf0lv_137",Qs="_modal-title_mf0lv_145",Ys="_modal-close_mf0lv_150",Zs="_tabs_mf0lv_159",eo="_tab_mf0lv_159",to="_tabActive_mf0lv_178",so="_modal-body_mf0lv_183",oo="_tabContent_mf0lv_188",ao="_form-group_mf0lv_191",no="_form-label_mf0lv_194",ro="_form-input_mf0lv_201",io="_form-hint_mf0lv_218",lo="_modal-footer_mf0lv_223",co="_btn-cancel_mf0lv_228",mo="_btn-primary_mf0lv_241",po="_delete-link_mf0lv_261",_o="_promptsIntro_mf0lv_275",uo="_promptsList_mf0lv_281",go="_promptItem_mf0lv_286",ho="_promptItemHeader_mf0lv_292",fo="_promptItemName_mf0lv_298",vo="_promptItemActions_mf0lv_303",xo="_promptTextarea_mf0lv_307",yo="_promptPreview_mf0lv_327",bo="_promptEmpty_mf0lv_337",jo="_btnSmall_mf0lv_342",wo="_btnSmallCancel_mf0lv_355",Io="_btnSmallDelete_mf0lv_368",u={"model-list-container":"_model-list-container_mf0lv_1",modelListContainer:Bs,"settings-icon":"_settings-icon_mf0lv_7",settingsIcon:Ds,"models-list":"_models-list_mf0lv_29",modelsList:qs,"home-models":"_home-models_mf0lv_38",homeModels:Ks,"model-avatar":"_model-avatar_mf0lv_45",modelAvatar:Us,"model-avatar-img":"_model-avatar-img_mf0lv_63",modelAvatarImg:Ws,"model-name":"_model-name_mf0lv_70",modelName:Fs,"model-avatar-chosen":"_model-avatar-chosen_mf0lv_89",modelAvatarChosen:Gs,"modal-overlay":"_modal-overlay_mf0lv_93",modalOverlay:Hs,fadeIn:zs,settingsModal:Vs,slideUp:Js,"modal-header":"_modal-header_mf0lv_137",modalHeader:Xs,"modal-title":"_modal-title_mf0lv_145",modalTitle:Qs,"modal-close":"_modal-close_mf0lv_150",modalClose:Ys,tabs:Zs,tab:eo,tabActive:to,"modal-body":"_modal-body_mf0lv_183",modalBody:so,tabContent:oo,"form-group":"_form-group_mf0lv_191",formGroup:ao,"form-label":"_form-label_mf0lv_194",formLabel:no,"form-input":"_form-input_mf0lv_201",formInput:ro,"form-hint":"_form-hint_mf0lv_218",formHint:io,"modal-footer":"_modal-footer_mf0lv_223",modalFooter:lo,"btn-cancel":"_btn-cancel_mf0lv_228",btnCancel:co,"btn-primary":"_btn-primary_mf0lv_241",btnPrimary:mo,"delete-link":"_delete-link_mf0lv_261",deleteLink:po,promptsIntro:_o,promptsList:uo,promptItem:go,promptItemHeader:ho,promptItemName:fo,promptItemActions:vo,promptTextarea:xo,promptPreview:yo,promptEmpty:bo,btnSmall:jo,btnSmallCancel:wo,btnSmallDelete:Io},ke="model_avatar_",se="omnitalk9_api_key",oe="system_prompt_";function Co(e){var w;const t=React.useRef(null);me(),Q();const s=Y(),[a,o]=React.useState(""),r=s.privateChat===e.model.model;React.useEffect(()=>{const v=localStorage.getItem(ke+e.model.model);v&&o(v)},[e.model.model]);const m=v=>{v.preventDefault(),v.stopPropagation(),r?s.setPrivateChat(null):s.setPrivateChat(e.model.model)},d=v=>{var S;v.preventDefault(),v.stopPropagation(),(S=t.current)==null||S.click()},x=v=>{var M;const S=(M=v.target.files)==null?void 0:M[0];if(!S)return;if(!S.type.startsWith("image/")){b.warning("请选择图片文件");return}const l=new FileReader;l.onload=O=>{var I;const R=(I=O.target)==null?void 0:I.result;localStorage.setItem(ke+e.model.model,R),o(R),b.success("头像已更新")},l.onerror=()=>{b.error("读取文件失败")},l.readAsDataURL(S)},k=a||((w=e.model.webui)==null?void 0:w.avatar)||"";return n.jsxs(n.Fragment,{children:[n.jsx("input",{ref:t,type:"file",accept:"image/*",style:{display:"none"},onChange:x}),n.jsxs("div",{className:`${u.modelAvatar} ${r?u.modelAvatarChosen:""}`,onClick:m,onContextMenu:d,title:"左键: 进入/退出私聊 | 右键: 上传头像",children:[n.jsx("img",{src:k,className:u.modelAvatarImg,alt:e.model.provider}),n.jsxs("div",{className:u.modelName,children:["@",e.model.model||e.model.provider]})]})]})}const So=()=>n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),ko=()=>{const{models:e}=React.useContext(pe),[t,s]=React.useState(!1),[a,o]=React.useState("api"),[r,m]=React.useState(""),[d,x]=React.useState(""),[k,w]=React.useState(!1),[v,S]=React.useState(""),[l,M]=React.useState({}),[O,R]=React.useState(null),[I,P]=React.useState(""),B=React.useRef(null);React.useEffect(()=>{const i=localStorage.getItem(se);i&&(m(i),x(i));const f=localStorage.getItem("app_custom_logo");f&&S(f),p()},[]);const p=()=>{const i={};e&&Object.keys(e).forEach(f=>{const y=localStorage.getItem(oe+f);y&&(i[f]=y)}),M(i)},h=i=>{var f;i.preventDefault(),i.stopPropagation(),(f=B.current)==null||f.click()},A=i=>{var T;const f=(T=i.target.files)==null?void 0:T[0];if(!f)return;if(!f.type.startsWith("image/")){b.warning("请选择图片文件");return}const y=new FileReader;y.onload=L=>{var C;const N=(C=L.target)==null?void 0:C.result;localStorage.setItem("app_custom_logo",N),S(N),b.success("图标已更新")},y.onerror=()=>{b.error("读取文件失败")},y.readAsDataURL(f)},H=v,Z=async()=>{const i=d.trim();if(!i){b.warning("请输入 API Key");return}if(!i.startsWith("sk-or-v1-")&&!i.startsWith("sk-")){b.warning("无效的 OpenRouter API Key 格式");return}w(!0);try{const y=await(await fetch("/api/key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:i})})).json();y.status==="ok"?(localStorage.setItem(se,i),m(i),b.success("API Key 保存成功")):b.error(y.message||"保存失败")}catch{b.error("保存失败")}finally{w(!1)}},J=async()=>{w(!0);try{(await(await fetch("/api/key",{method:"DELETE"})).json()).status==="ok"&&(localStorage.removeItem(se),m(""),x(""),b.success("API Key 已删除"))}catch{b.error("删除失败")}finally{w(!1)}},ee=i=>{R(i),P(l[i]||"")},c=i=>{localStorage.setItem(oe+i,I),M(f=>({...f,[i]:I})),R(null),b.success(`${i} 的 System Prompt 已保存`)},_=i=>{localStorage.removeItem(oe+i),M(f=>{const y={...f};return delete y[i],y}),b.success(`${i} 的 System Prompt 已删除`)},j=i=>({chatgpt:"ChatGPT",claude:"Claude",grok:"Grok",gemini:"Gemini",glm:"GLM",kimi:"Kimi",minimax:"MiniMax",qwen:"Qwen",deepseek:"DeepSeek",seed:"Seed"})[i]||i;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:u.modelListContainer,children:[n.jsx("input",{ref:B,type:"file",accept:"image/*",style:{display:"none"},onChange:A}),n.jsx("div",{className:u.settingsIcon,onClick:()=>{x(r),p(),s(!0)},onContextMenu:h,title:"左键: 设置 | 右键: 上传图标",children:v?n.jsx("img",{src:H,alt:"settings"}):n.jsx(So,{})}),n.jsx("div",{className:u.modelsList,children:e&&Object.keys(e).map(i=>n.jsx(Co,{model:{model:i,...e[i]}},i))})]}),t&&n.jsx("div",{className:u.modalOverlay,onClick:()=>s(!1),children:n.jsxs("div",{className:u.settingsModal,onClick:i=>i.stopPropagation(),children:[n.jsxs("div",{className:u.modalHeader,children:[n.jsx("span",{className:u.modalTitle,children:"设置"}),n.jsx("span",{className:u.modalClose,onClick:()=>s(!1),children:"×"})]}),n.jsxs("div",{className:u.tabs,children:[n.jsx("div",{className:`${u.tab} ${a==="api"?u.tabActive:""}`,onClick:()=>o("api"),children:"API 配置"}),n.jsx("div",{className:`${u.tab} ${a==="prompts"?u.tabActive:""}`,onClick:()=>o("prompts"),children:"System Prompt"})]}),n.jsxs("div",{className:u.modalBody,children:[a==="api"&&n.jsxs("div",{className:u.tabContent,children:[n.jsxs("div",{className:u.formGroup,children:[n.jsx("label",{className:u.formLabel,children:"OpenRouter API Key"}),n.jsx("input",{className:u.formInput,value:d,onChange:i=>x(i.target.value),placeholder:"sk-or-v1-xxxxxx"}),n.jsx("div",{className:u.formHint,children:"请输入 OpenRouter API Key，格式：sk-or-v1-xxxxxx"})]}),n.jsxs("div",{className:u.modalFooter,children:[n.jsx("button",{className:u.btnCancel,onClick:()=>s(!1),children:"取消"}),n.jsx("button",{className:u.btnPrimary,onClick:Z,disabled:k,children:k?"保存中...":"保存"})]}),r&&n.jsx("div",{className:u.deleteLink,children:n.jsx("span",{onClick:J,children:"删除 API Key"})})]}),a==="prompts"&&n.jsxs("div",{className:u.tabContent,children:[n.jsx("div",{className:u.promptsIntro,children:"为每个 AI 模型设置自定义的 System Prompt"}),n.jsx("div",{className:u.promptsList,children:e&&Object.keys(e).map(i=>n.jsxs("div",{className:u.promptItem,children:[n.jsxs("div",{className:u.promptItemHeader,children:[n.jsx("span",{className:u.promptItemName,children:j(i)}),n.jsx("div",{className:u.promptItemActions,children:O===i?n.jsxs(n.Fragment,{children:[n.jsx("button",{className:u.btnSmall,onClick:()=>c(i),children:"保存"}),n.jsx("button",{className:u.btnSmallCancel,onClick:()=>R(null),children:"取消"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:u.btnSmall,onClick:()=>ee(i),children:l[i]?"编辑":"添加"}),l[i]&&n.jsx("button",{className:u.btnSmallDelete,onClick:()=>_(i),children:"删除"})]})})]}),O===i?n.jsx("textarea",{className:u.promptTextarea,value:I,onChange:f=>P(f.target.value),placeholder:"在这里输入 System Prompt..."}):l[i]?n.jsx("div",{className:u.promptPreview,children:l[i]}):n.jsx("div",{className:u.promptEmpty,children:"未设置 System Prompt"})]},i))})]})]})]})})]})},Ao=""+new URL("send-5bb2204f.png",import.meta.url).href,Lo="_input-container_1weja_1",Mo="_home-input-wrapper_1weja_5",Ro="_prompt-input_1weja_23",Po="_prompt-clip_1weja_35",To="_sending_1weja_41",No="_mentionPopup_1weja_45",Eo="_mentionItem_1weja_59",Oo="_chosenMention_1weja_66",$o="_home-prompt-wrapper_1weja_78",Bo="_prompt_1weja_23",Do="_prompt-trash_1weja_108",qo="_prompt-operation_1weja_112",Ko="_chosen-prompt_1weja_117",Uo="_model-item_1weja_121",Wo="_model-avatar_1weja_126",W={"input-container":"_input-container_1weja_1",inputContainer:Lo,"home-input-wrapper":"_home-input-wrapper_1weja_5",homeInputWrapper:Mo,"prompt-input":"_prompt-input_1weja_23",promptInput:Ro,"prompt-clip":"_prompt-clip_1weja_35",promptClip:Po,sending:To,mentionPopup:No,mentionItem:Eo,chosenMention:Oo,"home-prompt-wrapper":"_home-prompt-wrapper_1weja_78",homePromptWrapper:$o,prompt:Bo,"prompt-trash":"_prompt-trash_1weja_108",promptTrash:Do,"prompt-operation":"_prompt-operation_1weja_112",promptOperation:qo,"chosen-prompt":"_chosen-prompt_1weja_117",chosenPrompt:Ko,"model-item":"_model-item_1weja_121",modelItem:Uo,"model-avatar":"_model-avatar_1weja_126",modelAvatar:Wo},Ae=Et,Le={openai:"chatgpt",anthropic:"claude",xai:"grok",google:"gemini",zhipu:"glm",moonshot:"kimi",minimax:"minimax",qwen:"qwen",deepseek:"deepseek",bytedance:"seed"},Fo=()=>{const e=Q(),t=Y(),s=React.useRef(null),a=React.useRef(null),o=t.privateChat,[r,m]=React.useState(""),[d,x]=React.useState(!1),[k,w]=React.useState(""),[v,S]=React.useState(0),[l,M]=React.useState([]),[O,R]=React.useState(!1);React.useEffect(()=>{const c=["@所有人",...Ae];if(k==="")M(c);else{const _=c.filter(j=>j.toLowerCase().includes(k.toLowerCase()));M(_)}S(0)},[k]),React.useEffect(()=>{if(d&&a.current){const c=a.current.children[v];c&&c.scrollIntoView({block:"nearest",behavior:"smooth"})}},[v,d]);const I=c=>{const _=c.target.value;m(_);const j=_.lastIndexOf("@");if(j!==-1){const i=_.slice(j+1);if(!i.includes(" ")&&!i.includes(`
`)){w(i),x(!0);return}}x(!1),w("")},P=c=>{var i;const _=r.lastIndexOf("@");let j;c==="@所有人"?j=r.slice(0,_)+"@所有人 ":j=r.slice(0,_)+"@"+c+" ",m(j),x(!1),(i=s.current)==null||i.focus()},B="ai_context_history",p=(c,_)=>{const j=localStorage.getItem(B),i=j?JSON.parse(j):{};i[c]=_,localStorage.setItem(B,JSON.stringify(i))},h=c=>{const _=localStorage.getItem(B);return _?JSON.parse(_)[c]||[]:[]},A=c=>{const _=[],j=h(c);_.push(...j);const i=e.sessions.find(f=>f.name==="group");if(i&&i.messages){for(const f of i.messages)if(f.sender_type==="user")_.push({role:"user",content:f.text});else if(f.sender_type==="assistant"){const y=f.provider===c?"assistant":"user";_.push({role:y,content:f.text})}}if(o){const f=e.sessions.find(y=>y.name===o.toLowerCase());if(f&&f.messages)for(const y of f.messages)y.sender_type==="user"?_.push({role:"user",content:y.text}):y.sender_type==="assistant"&&_.push({role:"assistant",content:y.text})}return _},H=async(c,_,j)=>{const i=Le[c]||c,f=o?i:"group",y=A(c);try{const T=await fetch(`/api/v1/${c}/chat/completions/non-stream`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":j},body:JSON.stringify({model:c,messages:[{role:"system",content:Z(c)},...y],max_tokens:3e3})});let L="";if(!T.ok)L=`[错误: HTTP ${T.status}]`;else{const C=await T.json();C.success&&C.msg?L=C.msg:C.choices&&C.choices[0]&&C.choices[0].message?L=C.choices[0].message.content||"无回复":C.msg?L=C.msg:L="[无回复]"}const N=[...y,{role:"user",content:_},{role:"assistant",content:L}];p(c,N),e.addMessage(f,{id:Date.now()+Math.random(),text:L,sender_type:"assistant",model:i,provider:c,date:new Date().toLocaleString(),stream:!1})}catch(T){e.addMessage(f,{id:Date.now()+Math.random(),text:`[错误: ${T.message}]`,sender_type:"assistant",model:i,provider:c,date:new Date().toLocaleString(),stream:!1})}},Z=c=>{const _=Le[c],j=_?localStorage.getItem("system_prompt_"+_):null;return j&&j.trim()?j:{openai:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=ChatGPT，小庄微信群里的朋友。简洁回复，像微信聊天。",anthropic:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Claude，小庄微信群里的朋友。简洁回复，像微信聊天。",xai:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Grok，小庄微信群里的朋友。简洁回复，像微信聊天。",google:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Gemini，小庄微信群里的朋友。简洁回复，像微信聊天。",zhipu:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=GLM，小庄微信群里的朋友。简洁回复，像微信聊天。",moonshot:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Kimi，小庄微信群里的朋友。简洁回复，像微信聊天。",minimax:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=MiniMax，小庄微信群里的朋友。简洁回复，像微信聊天。",qwen:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Qwen，小庄微信群里的朋友。简洁回复，像微信聊天。",deepseek:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=DeepSeek，小庄微信群里的朋友。简洁回复，像微信聊天。",bytedance:"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！你=Seed，小庄微信群里的朋友。简洁回复，像微信聊天。"}[c]||"【强制规则】你只能回复一句话，不超过35字！不要重复用户的话！不要替其他AI说话！"},J=async()=>{const c=r.trim();if(!c||O)return;R(!0);let _=[];if(o){const L={chatgpt:"openai",claude:"anthropic",grok:"xai",gemini:"google",glm:"zhipu",kimi:"moonshot",minimax:"minimax",qwen:"qwen",deepseek:"deepseek",seed:"bytedance"}[o.toLowerCase()];L&&(_=[L])}else if(c.includes("@所有人"))_=["openai","anthropic","xai","google","zhipu","moonshot","minimax","qwen","deepseek","bytedance"];else{const T={chatgpt:"openai",claude:"anthropic",grok:"xai",gemini:"google",glm:"zhipu",kimi:"moonshot",minimax:"minimax",qwen:"qwen",deepseek:"deepseek",seed:"bytedance"};for(const L of Ae)if(c.includes("@"+L)){const N=T[L];N&&!_.includes(N)&&_.push(N)}if(_.length===0){const N=[...["openai","anthropic","xai","google","zhipu","moonshot","minimax","qwen","deepseek","bytedance"]];for(let C=N.length-1;C>0;C--){const _e=Math.floor(Math.random()*(C+1));[N[C],N[_e]]=[N[_e],N[C]]}_=N.slice(0,3)}}const j=localStorage.getItem("omnitalk9_api_key");if(!j){b.error("请先设置 API Key"),R(!1);return}const i={id:Date.now(),text:c,sender_type:"user",provider:"user",date:new Date().toLocaleString(),stream:!1},f=o||"group";e.addMessage(f,i),m("");const y=_.map(T=>H(T,c,j));try{await Promise.all(y)}catch(T){b.error("发送失败: "+T.message)}finally{R(!1)}},ee=c=>{if(d&&l.length>0){if(c.key==="ArrowDown"){c.preventDefault(),S(_=>(_+1)%l.length);return}if(c.key==="ArrowUp"){c.preventDefault(),S(_=>(_-1+l.length)%l.length);return}if(c.key==="Enter"||c.key==="Tab"){c.preventDefault(),l[v]&&P(l[v]);return}if(c.key==="Escape"){x(!1);return}}if(c.key==="Enter"&&!c.shiftKey){if(c.metaKey||c.ctrlKey)return;c.preventDefault(),r.trim()&&J()}};return n.jsxs("div",{className:W.inputContainer,children:[n.jsxs("div",{className:W.homeInputWrapper,children:[n.jsx("input",{ref:s,type:"text",className:W.promptInput,value:r,onChange:I,onKeyDown:ee,placeholder:"输入消息，@可提及AI，回车发送，Cmd+回车换行",disabled:O}),n.jsx("img",{className:re(W.promptClip,{[W.sending]:O}),src:Ao,alt:"send-message",onClick:J})]}),d&&l.length>0&&n.jsx("div",{ref:a,className:W.mentionPopup,children:l.map((c,_)=>n.jsx("div",{className:re(W.mentionItem,{[W.chosenMention]:_===v}),onClick:()=>P(c),children:c},c))})]})},Go="_home_1jjqj_1",Ho="_leftColumn_1jjqj_11",zo="_headerRow_1jjqj_18",Vo="_promptInputWrapper_1jjqj_27",Jo="_clearBtn_1jjqj_31",Xo="_homeChats_1jjqj_51",Qo="_modelListWrapper_1jjqj_60",Yo="_homeModal_1jjqj_69",Zo="_confirmOverlay_1jjqj_76",ea="_fadeIn_1jjqj_1",ta="_confirmModal_1jjqj_98",sa="_slideUp_1jjqj_1",oa="_confirmIcon_1jjqj_119",aa="_confirmTitle_1jjqj_134",na="_confirmContent_1jjqj_140",ra="_confirmActions_1jjqj_146",ia="_confirmCancel_1jjqj_151",la="_confirmOk_1jjqj_164",$={home:Go,leftColumn:Ho,headerRow:zo,promptInputWrapper:Vo,clearBtn:Jo,homeChats:Xo,modelListWrapper:Qo,homeModal:Yo,confirmOverlay:Zo,fadeIn:ea,confirmModal:ta,slideUp:sa,confirmIcon:oa,confirmTitle:aa,confirmContent:na,confirmActions:ra,confirmCancel:ia,confirmOk:la},ca=()=>{const e=Y(),t=Q(),s=e.privateChat,[a,o]=React.useState(!1),r=()=>{o(!0)},m=()=>{const d=s||"group";t.clearCurrentSession(d),b.success("当前聊天记录已清除"),o(!1)};return n.jsxs("div",{className:$.home,children:[n.jsxs("div",{className:$.leftColumn,children:[n.jsxs("div",{className:$.headerRow,children:[n.jsx(Fo,{}),n.jsx("button",{className:$.clearBtn,onClick:r,title:"清除聊天记录",children:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]}),n.jsx("div",{className:$.homeChats,children:n.jsx($s,{})})]}),n.jsx("div",{className:$.modelListWrapper,children:n.jsx(ko,{})}),a&&n.jsx("div",{className:$.confirmOverlay,onClick:()=>o(!1),children:n.jsxs("div",{className:$.confirmModal,onClick:d=>d.stopPropagation(),children:[n.jsx("div",{className:$.confirmIcon,children:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),n.jsx("div",{className:$.confirmTitle,children:"确认清除"}),n.jsx("div",{className:$.confirmContent,children:"确定要清除当前聊天记录吗？此操作无法撤销。"}),n.jsxs("div",{className:$.confirmActions,children:[n.jsx("button",{className:$.confirmCancel,onClick:()=>o(!1),children:"取消"}),n.jsx("button",{className:$.confirmOk,onClick:m,children:"确认清除"})]})]})})]})},ma=()=>n.jsx(ft,{children:n.jsx(vt,{children:n.jsx(xt,{path:"/",element:n.jsx(ca,{})})})}),da=({children:e})=>{const[t,s]=React.useState(Nt),[a,o]=React.useState(It),[r,m]=React.useState(!0);React.useEffect(()=>{m(!0),fetch("/config/json").then(x=>x.json()).then(x=>{if(x&&typeof x.models=="object"){const k=x.models,w=[];s(k),Object.keys(k).forEach(v=>{k[v].webui.isStream!==!1&&!w.includes(v)&&w.push(v)}),w.length>0&&o(w)}}).catch(x=>{console.log(x)}).finally(()=>{m(!1)})},[]);const d=React.useMemo(()=>({models:t,streamModels:a}),[t]);return n.jsx(pe.Provider,{value:d,children:!r&&e})},pa="_header_1lr6h_1",_a="_header-title_1lr6h_11",ua="_logo-text_1lr6h_14",ga="_header-operation_1lr6h_24",ha="_settings-icon_1lr6h_28",fa="_modal-overlay_1lr6h_43",va="_fadeIn_1lr6h_1",xa="_modal-content_1lr6h_65",ya="_slideUp_1lr6h_1",ba="_modal-header_1lr6h_84",ja="_modal-title_1lr6h_91",wa="_modal-close_1lr6h_96",Ia="_modal-body_1lr6h_105",Ca="_form-group_1lr6h_108",Sa="_form-label_1lr6h_111",ka="_form-input_1lr6h_118",Aa="_form-hint_1lr6h_135",La="_modal-footer_1lr6h_140",Ma="_btn-cancel_1lr6h_145",Ra="_btn-primary_1lr6h_158",Pa="_delete-link_1lr6h_178",ae={header:pa,"header-title":"_header-title_1lr6h_11",headerTitle:_a,"logo-text":"_logo-text_1lr6h_14",logoText:ua,"header-operation":"_header-operation_1lr6h_24",headerOperation:ga,"settings-icon":"_settings-icon_1lr6h_28",settingsIcon:ha,"modal-overlay":"_modal-overlay_1lr6h_43",modalOverlay:fa,fadeIn:va,"modal-content":"_modal-content_1lr6h_65",modalContent:xa,slideUp:ya,"modal-header":"_modal-header_1lr6h_84",modalHeader:ba,"modal-title":"_modal-title_1lr6h_91",modalTitle:ja,"modal-close":"_modal-close_1lr6h_96",modalClose:wa,"modal-body":"_modal-body_1lr6h_105",modalBody:Ia,"form-group":"_form-group_1lr6h_108",formGroup:Ca,"form-label":"_form-label_1lr6h_111",formLabel:Sa,"form-input":"_form-input_1lr6h_118",formInput:ka,"form-hint":"_form-hint_1lr6h_135",formHint:Aa,"modal-footer":"_modal-footer_1lr6h_140",modalFooter:La,"btn-cancel":"_btn-cancel_1lr6h_145",btnCancel:Ma,"btn-primary":"_btn-primary_1lr6h_158",btnPrimary:Ra,"delete-link":"_delete-link_1lr6h_178",deleteLink:Pa},Ta=()=>n.jsx("div",{className:ae.header,children:n.jsx("div",{className:ae.headerTitle,children:n.jsx("span",{className:ae.logoText,children:"OmniTalk X"})})});const Na=()=>n.jsx(da,{children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[n.jsx(Ta,{}),n.jsx("div",{style:{flex:1,overflow:"hidden"},children:n.jsx(ma,{})})]})});yt.createRoot(document.getElementById("root")).render(n.jsx(Na,{}));
